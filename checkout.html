<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Checkout | VANTIQ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Razorpay -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,Helvetica,sans-serif}
body{background:#f5f5f5}

.container{
  max-width:1100px;
  margin:30px auto;
  display:flex;
  gap:20px;
  padding:10px;
}

/* FORM */
.checkout-form{
  flex:2;
  background:#fff;
  padding:20px;
  border-radius:6px;
}

.checkout-form h2{margin-bottom:20px}

.form-group{margin-bottom:15px}
label{display:block;margin-bottom:6px;font-size:14px}
input,textarea{
  width:100%;
  padding:10px;
  border:1px solid #ccc;
  border-radius:4px;
}
textarea{resize:none}

/* PAYMENT */
.payment-method{
  border:1px solid #ddd;
  padding:10px;
  border-radius:5px;
  margin-bottom:10px;
  cursor:pointer;
}
.payment-method input{margin-right:10px}

/* SUMMARY */
.summary{
  flex:1;
  background:#fff;
  padding:20px;
  border-radius:6px;
  height:fit-content;
}
.summary h3{margin-bottom:15px}
.summary-item{
  display:flex;
  justify-content:space-between;
  margin-bottom:8px;
  font-size:14px;
}
.place-order{
  width:100%;
  padding:14px;
  background:#000;
  color:#fff;
  border:none;
  cursor:pointer;
  font-size:16px;
  border-radius:5px;
  margin-top:10px;
}

/* MOBILE */
@media(max-width:768px){
  .container{flex-direction:column}
}
</style>
</head>

<body>

<div class="container">

  <!-- LEFT -->
  <div class="checkout-form">
    <h2>Shipping Details</h2>

    <div class="form-group">
      <label>Name</label>
      <input id="name">
    </div>

    <div class="form-group">
      <label>Mobile</label>
      <input id="phone">
    </div>

    <div class="form-group">
      <label>Address</label>
      <textarea id="address" rows="3"></textarea>
    </div>

    <h2>Payment Method</h2>

    <div class="payment-method">
      <input type="radio" name="payment" value="cod" checked>
      Cash on Delivery (COD)
    </div>

    <div class="payment-method">
      <input type="radio" name="payment" value="upi">
      UPI (Google Pay / PhonePe / Paytm)
    </div>

    <div class="payment-method">
      <input type="radio" name="payment" value="razorpay">
      Razorpay (Cards / UPI / Netbanking)
    </div>
  </div>

  <!-- RIGHT -->
  <div class="summary">
    <h3>Order Summary</h3>
    <div id="orderItems"></div>
    <hr>
    <div class="summary-item">
      <span>Subtotal</span>
      <span>₹<span id="subtotal">0</span></span>
    </div>
    <div class="summary-item">
      <span>Shipping</span>
      <span>₹50</span>
    </div>
    <hr>
    <div class="summary-item">
      <strong>Total</strong>
      <strong>₹<span id="total">0</span></strong>
    </div>

    <button class="place-order" onclick="placeOrder()">Place Order</button>
  </div>

</div>

<script>
const API_BASE = "https://vantiq-723z.onrender.com";

let subtotal = Number(localStorage.getItem("cartSubtotal"));

if(!subtotal || subtotal <= 0){
  alert("Cart amount missing. Redirecting to cart.");
  window.location.href = "cart.html";
}

function renderSummary(){
  document.getElementById("subtotal").innerText = subtotal;
  document.getElementById("total").innerText = subtotal + 50;
}

function placeOrder(){
  const payment = document.querySelector('input[name="payment"]:checked').value;

  if(payment === "cod"){
    completeOrder("Cash on Delivery");
  }

  if(payment === "upi"){
    alert("UPI Payment\nSend payment to: vantiq@upi\nAfter payment click OK");
    completeOrder("UPI");
  }

  if(payment === "razorpay"){
    razorpayPay();
  }
}

function razorpayPay(){
  const options = {
    key: "rzp_test_YourKeyHere",
    amount: (subtotal + 50) * 100,
    currency: "INR",
    name: "VANTIQ Store",
    description: "Order Payment",
    handler: function (response){
      completeOrder("Razorpay", response.razorpay_payment_id);
    },
    theme:{color:"#000"}
  };
  new Razorpay(options).open();
}

function completeOrder(method, paymentId=""){
  const items = JSON.parse(localStorage.getItem("cartItems")) || [];

  fetch("${API_BASE}/api/orders/create", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("token") // ✅ REQUIRED
    },
    body: JSON.stringify({
      name: document.getElementById("name").value,
      phone: document.getElementById("phone").value,
      address: document.getElementById("address").value,
      items,                         // ✅ REQUIRED
      totalAmount: subtotal + 50,
      paymentMethod: method,
      paymentId
    })
  })
  .then(res => res.json())
  .then(() => {
    localStorage.removeItem("cartSubtotal");
    localStorage.removeItem("cartItems");
    window.location.href = "thankyou.html";
  });
}



renderSummary();
</script>


</body>
</html>

