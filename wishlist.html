<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Wishlist | VANTIQ</title>

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
*{box-sizing:border-box}

body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#000;
  color:#fff;
}

/* HEADER */
header{
  background:#000;
  padding:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
}

header img{
  height:55px;
}

.cart-icon{
  position:absolute;
  right:15px;
  top:15px;
  font-size:20px;
  cursor:pointer;
}

.cart-icon span{
  background:red;
  padding:2px 6px;
  border-radius:50%;
  font-size:11px;
  position:absolute;
  top:-8px;
  right:-8px;
}

/* PAGE TITLE */
.page-title{
  text-align:center;
  margin:15px 0;
  font-size:20px;
}

/* PRODUCTS GRID */
.products-container{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:15px;
  padding:15px;
}

/* PRODUCT CARD */
.product-card{
  background:#111;
  border:1px solid #ff2e2e;
  border-radius:12px;
  padding:10px;
  position:relative;
}

.product-card img{
  width:100%;
  height:260px;
  object-fit:cover;
  border-radius:10px;
}

.product-card h3{
  font-size:14px;
  margin:8px 0 4px;
}

.price{
  color:#ff2e2e;
  font-weight:bold;
  font-size:14px;
}

/* WISHLIST HEART */
.wishlist-btn{
  position:absolute;
  top:8px;
  right:8px;
  background:#fff;
  color:#e60023;
  width:32px;
  height:32px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  font-size:15px;
}

/* ADD TO CART */
.add-cart-btn{
  margin-top:8px;
  width:100%;
  padding:9px;
  background:#ff9f00;
  border:none;
  font-weight:bold;
  font-size:14px;
  cursor:pointer;
  border-radius:8px;
}

.add-cart-btn:hover{
  background:#fb641b;
}

.empty{
  text-align:center;
  opacity:.7;
  margin-top:40px;
  font-size:15px;
}

/* TABLET & DESKTOP */
@media(min-width:768px){
  .products-container{
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  }
  .product-card img{
    height:420px;
  }
}


.product-click{
  cursor:pointer;
}

</style>
</head>

<body>

<header>
  <img src="logo1.jpg" alt="VANTIQ">
  <div class="cart-icon" onclick="location.href='cart.html'">
    üõí<span id="cartCount">0</span>
  </div>
</header>

<h2 class="page-title">‚ù§Ô∏è My Wishlist</h2>

<div class="products-container" id="wishlistContainer"></div>

<p class="empty" id="emptyMsg" style="display:none">
  Your wishlist is empty üòî
</p>

<script>
const API = "http://localhost:5000";
const token = localStorage.getItem("token");

if(!token){
  alert("Please login first");
  location.href="login.html";
}

// LOAD WISHLIST
async function loadWishlist(){
  const res = await fetch(API+"/api/wishlist",{
    headers:{ Authorization:"Bearer "+token }
  });
  const data = await res.json();

  const container = document.getElementById("wishlistContainer");
  container.innerHTML = "";

  if(!data.items || data.items.length === 0){
    document.getElementById("emptyMsg").style.display="block";
    return;
  }

  data.items.forEach(p=>{
    const card = document.createElement("div");
    card.className="product-card";
    card.innerHTML = `
  <div class="product-click" onclick="goToProduct('${p._id}')">
    <img src="${API}/uploads/${p.images[0]}">
    <h3>${p.name}</h3>
    <div class="price">‚Çπ${p.price}</div>
  </div>

  <div class="wishlist-btn"
       onclick="event.stopPropagation(); toggleWishlist('${p._id}')">‚ù§</div>

  <button class="add-cart-btn"
       onclick="event.stopPropagation(); addToCart('${p._id}')">
       ADD TO CART
  </button>
`;

    container.appendChild(card);
  });
}

// TOGGLE WISHLIST
async function toggleWishlist(productId){
  await fetch(API+"/api/wishlist/toggle",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      Authorization:"Bearer "+token
    },
    body:JSON.stringify({ productId })
  });
  loadWishlist();
}

// ADD TO CART
async function addToCart(productId){
  await fetch(API+"/api/cart/add",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      Authorization:"Bearer "+token
    },
    body:JSON.stringify({ productId })
  });
  alert("Added to cart ‚úÖ");
  updateCartCount();
}

// CART COUNT
async function updateCartCount(){
  const res = await fetch(API+"/api/cart",{
    headers:{Authorization:"Bearer "+token}
  });
  const cart = await res.json();
  const count = cart.items?.reduce((s,i)=>s+i.quantity,0) || 0;
  document.getElementById("cartCount").innerText = count;
}


function goToProduct(productId){
  window.location.href = `product-details.html?id=${productId}`;
}


window.onload=()=>{
  loadWishlist();
  updateCartCount();
}
</script>

</body>
</html>
